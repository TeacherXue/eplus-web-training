<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width,target-densitydpi=medium-dpi,initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="../../dist/css/reset.css">
    <link rel="stylesheet" href="../../dist/css/login.css">
    <title>登录</title>
</head>

<body>
    <h1 class="login-welcome">欢迎使用E+云服务</h1>
    <h2 class="login-title">登录</h2>
    <div class="line"></div>
    <div class="login-container">
        <form class="login-form" autocomplete="off" >
            <input class="username" type="text" name="username" placeholder="请输入手机号或帐号">
            <input class="password" type="password" name="password" placeholder="请输入密码">
            <input class="login-button" type="button" value="登录">
        </form>
        <div class="resigner-forget">
            <div class="resigner-button">
                <a href="#">立即注册</a>
            </div>
            <div class="v-line">

            </div>
            <div class="forget-button">
                <a href="#">忘记密码</a>
            </div>
            </>
        </div>
        <script src="../../lib/form-serialize/index.js"></script>
        <script src="../../lib/axios/axios.min.js"></script>
        <script src="../../lib/md5/md5.js"></script>

        <script src="../../utils/http/config/index.js"></script>
        <script src="../../utils/http/index.js"></script>
        <script src="../../utils/http/apis/apis.js"></script>
        <script src="../../utils/toast/index.js"></script>
        <script>
            //点击登录按钮调用登录接口
            let loginButton = document.querySelector('.login-button');
            loginButton.addEventListener('click', function () {
                let form = document.querySelector('.login-form');
                const data = serialize(form, { hash: true, empty: true });

                if (data.username === '') {
                    showToast("请输入用户名",2000);
                    return;
                }

                if (data.password === '') {
                    showToast("请输入密码",2000);
                    return;
                }

                login(data.username, hex_md5(data.password)).then((result) => {
                    console.log(result);
                    if (result.retCode === "000000") {
                        localStorage.setItem('accessToken', result.data.userInfo.accessToken);
                        showToast("登录成功",2000, function () {
                            window.location.href = '../home/home.html';
                        });
                    } else {
                        //显示登录失败toast
                        showToast("登录失败",2000);
                    }
                }).catch((err) => {
                    console.log(err);
                });
            })
        </script>
</body>

</html>